<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChatMPT</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica; background: #fff; margin: 0; display: flex; flex-direction: column; height: 100vh; }
        #chat-window { flex-grow: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 15px; }
        
        /* Message Bubbles */
        .msg { max-width: 80%; padding: 12px 16px; border-radius: 18px; line-height: 1.5; font-size: 15px; }
        .user { align-self: flex-end; background: #007aff; color: white; border-bottom-right-radius: 4px; }
        .bot { align-self: flex-start; background: #f1f1f2; color: #000; border-bottom-left-radius: 4px; }

        /* Modern Input Bar */
        .input-area { padding: 20px; border-top: 1px solid #eee; display: flex; justify-content: center; background: #fff; }
        .input-bar { width: 100%; max-width: 800px; background: #f4f4f4; border-radius: 26px; display: flex; align-items: flex-end; padding: 8px 14px; transition: box-shadow 0.2s; }
        .input-bar:focus-within { box-shadow: 0 0 0 2px #007aff33; background: #fff; border: 1px solid #007aff33; }
        
        textarea { flex: 1; border: none; background: transparent; padding: 10px; font-size: 16px; outline: none; resize: none; max-height: 200px; font-family: inherit; }
        
        .icon-btn { background: none; border: none; cursor: pointer; padding: 10px; color: #666; font-size: 18px; transition: 0.2s; display: flex; align-items: center; }
        .icon-btn:hover { color: #000; }
        .send-btn { background: #000; color: #fff; border-radius: 50%; width: 34px; height: 34px; justify-content: center; margin-left: 5px; opacity: 0.3; pointer-events: none; }
        .send-btn.active { opacity: 1; pointer-events: auto; }
    </style>
</head>
<body>

<div id="chat-window">
    <div class="msg bot">Hello! I am ChatMPT. How can I help you today?</div>
</div>

<div class="input-area">
    <div class="input-bar">
        <button class="icon-btn"><i class="fas fa-paperclip"></i></button>
        <textarea id="user-input" placeholder="Message ChatMPT..." rows="1"></textarea>
        <button class="icon-btn"><i class="fas fa-microphone"></i></button>
        <button id="send-btn" class="icon-btn send-btn"><i class="fas fa-arrow-up"></i></button>
    </div>
</div>

<script>
    const input = document.getElementById('user-input');
    const sendBtn = document.getElementById('send-btn');
    const chatWindow = document.getElementById('chat-window');

    // Auto-grow textarea
    input.addEventListener('input', () => {
        input.style.height = 'auto';
        input.style.height = input.scrollHeight + 'px';
        sendBtn.classList.toggle('active', input.value.trim().length > 0);
    });

    async function sendMessage() {
        const text = input.value.trim();
        if (!text) return;

        // Add User Message
        const uMsg = document.createElement('div');
        uMsg.className = 'msg user';
        uMsg.innerText = text;
        chatWindow.appendChild(uMsg);
        
        input.value = '';
        input.style.height = 'auto';
        sendBtn.classList.remove('active');
        chatWindow.scrollTo(0, chatWindow.scrollHeight);

        try {
            const res = await fetch('/v1/chat', {
                method: 'POST',
                headers: { 
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer my-secret-key-456' 
                },
                body: JSON.stringify({ prompt: text })
            });
            const data = await res.json();
            
            const bMsg = document.createElement('div');
            bMsg.className = 'msg bot';
            bMsg.innerText = data.reply;
            chatWindow.appendChild(bMsg);
            chatWindow.scrollTo(0, chatWindow.scrollHeight);
        } catch (e) {
            console.error(e);
        }
    }

    sendBtn.addEventListener('click', sendMessage);
    input.addEventListener('keypress', (e) => { if(e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendMessage(); } });
</script>

</body>
</html>
